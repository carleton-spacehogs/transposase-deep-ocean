init_env()
DNA_cov_file <- read_excel("data/DNA_Biofilm_Trans_ToxinAntitoxin_Coverage.xlsx")
RNA_cov_file <- read_excel("data/RNA_Biofilm_Trans_ToxinAntitoxin_Coverage.xlsx")
init_env <- function(){
library(readr)
library(scatterplot3d)
library(tidyverse)
library(ggpubr)
library(purrr)
library(ggpubr)
library(ggrepel)
library("ggplot2")
library("ggpmisc")
library("readxl")
library("car")
library("forcats")
library(grid)
library(gridExtra)
library("GGally")
library(dplyr)
library(data.table)
library(gridExtra)
library(stringr)
library(png)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path ))
getwd()
}
init_env()
DNA_cov_file <- read_excel("data/DNA_Biofilm_Trans_ToxinAntitoxin_Coverage.xlsx")
RNA_cov_file <- read_excel("data/RNA_Biofilm_Trans_ToxinAntitoxin_Coverage.xlsx")
DNA_RNA_connector <- read_excel("data/DNA_RNA_connector.xlsx")
DNA_Metadata <- read_excel("data/DNA_Location_Metadata.xlsx")
DNA_Metadata$Layer_DNA <- factor(DNA_Metadata$Layer_DNA, levels = c("SRF", "DCM", "MIX", "MES"))
DNA_Metadata$Ocean_short<-factor(DNA_Metadata$Ocean_short)
DNA_Metadata$upper_size_dna <- factor(DNA_Metadata$upper_size_dna, levels = c("1.6", "3"))
RNA_Metadata <- read_excel("data/RNA_Location_Metadata.xlsx")
RNA_Metadata <- RNA_Metadata %>% mutate(Layer_RNA = ifelse(Layer_RNA != "MIX", Layer_RNA,
ifelse(Depth_RNA <= 120, "DCM", "MES")))
RNA_Metadata$Layer_RNA <- factor(RNA_Metadata$Layer_RNA, levels = c("SRF", "DCM", "MES"))
RNA_Metadata$upper_size_rna <- factor(RNA_Metadata$upper_size_rna, levels = c("1.6", "3"))
DNA_tara <- merge(x=DNA_Metadata, y=DNA_cov_file, by ='connector_DNA', all = TRUE)
RNA_tara <- merge(x=RNA_Metadata, y=RNA_cov_file, by ='connector_RNA', all = TRUE)
DNA_Merged <- merge(x=DNA_RNA_connector, y=DNA_tara, by = 'connector_DNA', all = FALSE)
DNA_RNA_tara <- merge(x=DNA_Merged, y=RNA_tara, by ='connector_RNA', all = FALSE)
DNA_RNA_tara$biofilm_exp_rate <- DNA_RNA_tara$RNA_Biofilm/DNA_RNA_tara$DNA_Biofilm
DNA_RNA_tara$trans_exp_rate <- DNA_RNA_tara$RNA_Trans/DNA_RNA_tara$DNA_Transposase
DNA_RNA_tara$toxin_exp_rate <- DNA_RNA_tara$RNA_TA/DNA_RNA_tara$DNA_TA
DNA_RNA_tara$defense_exp_rate <- DNA_RNA_tara$RNA_Defense/DNA_RNA_tara$DNA_Defense
DNA_RNA_tara <- DNA_RNA_tara%>%group_by(Layer_DNA)%>%
mutate(mean_layer_trans_exp=mean(trans_exp_rate),
mean_layer_biofilm_exp=mean(biofilm_exp_rate),
median_dna_trans = median(DNA_Transposase),
median_dna_biofilm = median(DNA_Biofilm),
median_dna_defense = median(DNA_Defense),
mean_dna_trans = mean(DNA_Transposase),
mean_dna_biofilm = mean(DNA_Biofilm),
mean_dna_defense = mean(DNA_Defense),
mean_dna_toxin = mean(DNA_TA),
median_rna_trans = median(RNA_Trans),
median_rna_biofilm = median(RNA_Biofilm),
median_rna_defense = median(RNA_Defense)
)
rm(DNA_cov_file, RNA_cov_file, DNA_Merged, DNA_RNA_connector, DNA_Metadata, RNA_Metadata)
depth_comparisons <- list( c("SRF", "DCM"), c("DCM", "MES"), c("SRF", "MES") )
DNA_tara$Depth <- as.numeric(DNA_tara$Depth_DNA)
RNA_tara$Depth <- as.numeric(RNA_tara$Depth_RNA)
DNA_tara <- mutate(DNA_tara, is_MES = ifelse(Layer_DNA == "MES", "MES, Malaspina",
ifelse(Layer_DNA == "MIX", "MIX", "SRF, DCM")))
init_env()
DNA_cov_file <- read_excel("data/DNA_Biofilm_Trans_ToxinAntitoxin_Coverage.xlsx")
RNA_cov_file <- read_excel("data/RNA_Biofilm_Trans_ToxinAntitoxin_Coverage.xlsx")
DNA_RNA_connector <- read_excel("data/DNA_RNA_connector.xlsx")
DNA_Metadata <- read_excel("data/DNA_Location_Metadata.xlsx")
DNA_Metadata$Depth <- as.numeric(DNA_Metadata$Depth_DNA)
DNA_Metadata$Layer_DNA <- factor(DNA_Metadata$Layer_DNA, levels = c("SRF", "DCM", "MIX", "MES"))
DNA_Metadata$Ocean_short<-factor(DNA_Metadata$Ocean_short)
DNA_Metadata$upper_size_dna <- factor(DNA_Metadata$upper_size_dna, levels = c("1.6", "3"))
RNA_Metadata <- read_excel("data/RNA_Location_Metadata.xlsx")
RNA_Metadata <- RNA_Metadata %>% mutate(Layer_RNA = ifelse(Layer_RNA != "MIX", Layer_RNA,
ifelse(Depth_RNA <= 120, "DCM", "MES")))
RNA_Metadata$Depth <- as.numeric(RNA_Metadata$Depth_RNA)
RNA_Metadata$Layer_RNA <- factor(RNA_Metadata$Layer_RNA, levels = c("SRF", "DCM", "MES"))
RNA_Metadata$upper_size_rna <- factor(RNA_Metadata$upper_size_rna, levels = c("1.6", "3"))
DNA_tara <- merge(x=DNA_Metadata, y=DNA_cov_file, by ='connector_DNA', all = TRUE)
RNA_tara <- merge(x=RNA_Metadata, y=RNA_cov_file, by ='connector_RNA', all = TRUE)
DNA_Merged <- merge(x=DNA_RNA_connector, y=DNA_tara, by = 'connector_DNA', all = FALSE)
DNA_RNA_tara <- merge(x=DNA_Merged, y=RNA_tara, by ='connector_RNA', all = FALSE)
DNA_RNA_tara$biofilm_exp_rate <- DNA_RNA_tara$RNA_Biofilm/DNA_RNA_tara$DNA_Biofilm
DNA_RNA_tara$trans_exp_rate <- DNA_RNA_tara$RNA_Trans/DNA_RNA_tara$DNA_Transposase
DNA_RNA_tara$toxin_exp_rate <- DNA_RNA_tara$RNA_TA/DNA_RNA_tara$DNA_TA
DNA_RNA_tara$defense_exp_rate <- DNA_RNA_tara$RNA_Defense/DNA_RNA_tara$DNA_Defense
DNA_RNA_tara <- DNA_RNA_tara%>%group_by(Layer_DNA)%>%
mutate(mean_layer_trans_exp=mean(trans_exp_rate),
mean_layer_biofilm_exp=mean(biofilm_exp_rate),
median_dna_trans = median(DNA_Transposase),
median_dna_biofilm = median(DNA_Biofilm),
median_dna_defense = median(DNA_Defense),
mean_dna_trans = mean(DNA_Transposase),
mean_dna_biofilm = mean(DNA_Biofilm),
mean_dna_defense = mean(DNA_Defense),
mean_dna_toxin = mean(DNA_TA),
median_rna_trans = median(RNA_Trans),
median_rna_biofilm = median(RNA_Biofilm),
median_rna_defense = median(RNA_Defense)
)
rm(DNA_cov_file, RNA_cov_file, DNA_Merged, DNA_RNA_connector, DNA_Metadata, RNA_Metadata)
depth_comparisons <- list( c("SRF", "DCM"), c("DCM", "MES"), c("SRF", "MES") )
DNA_tara <- mutate(DNA_tara, is_MES = ifelse(Layer_DNA == "MES", "MES, BAT",
ifelse(Layer_DNA == "MIX", "MIX", "SRF, DCM")))
setwd(dirname(rstudioapi::getActiveDocumentContext()$path ))
source("./init_share.R")
g(DNA_tara, RNA_tara, DNA_RNA_tara, depth_comparison) %=% init_tara()
mala_cov <- init_mala_cov()
options(scipen=10000)
# DNA_RNA_tara <- DNA_RNA_tara %>% filter(Layer_DNA != "MIX")
DNA_RNA_tara %>%
ggplot(aes(x=Layer_RNA, y=trans_exp_rate)) +
geom_boxplot(aes(fill = median_dna_trans))
DNA_RNA_tara %>%
ggplot(aes(x=Layer_DNA, y=trans_exp_rate)) +
geom_boxplot(aes(fill = median_dna_trans))
DNA_RNA_tara %>%
ggplot(aes(x=Layer_RNA, y=trans_exp_rate)) +
geom_boxplot(aes(fill = median_dna_trans))
RNA_Metadata <- read_excel("data/RNA_Location_Metadata.xlsx")
View(RNA_Metadata)
RNA_Metadata$Depth_RNA
RNA_Metadata %>% filter(!is.na(Depth_RNA))
RNA_Metadata <- filter(RNA_Metadata, !is.na(Depth_RNA))
RNA_Metadata <- read_excel("data/RNA_Location_Metadata.xlsx")
RNA_Metadata$Depth <- as.numeric(RNA_Metadata$Depth_RNA)
RNA_Metadata <- filter(RNA_Metadata, !is.na(Depth_RNA))
RNA_Metadata <- read_excel("data/RNA_Location_Metadata.xlsx")
RNA_Metadata <- filter(RNA_Metadata, !is.na(Depth_RNA))
filter(RNA_Metadata, !is.na(Depth_RNA))
RNA_Metadata <- read_excel("data/RNA_Location_Metadata.xlsx")
RNA_Metadata <- filter(RNA_Metadata, Depth_RNA != "NA")
RNA_Metadata$Depth <- as.numeric(RNA_Metadata$Depth_RNA)
RNA_Metadata <- RNA_Metadata %>% mutate(Layer_RNA = ifelse(Layer_RNA != "MIX", Layer_RNA,
ifelse(Depth_RNA <= 120, "DCM", "MES")))
setwd(dirname(rstudioapi::getActiveDocumentContext()$path ))
source("./init_share.R")
g(DNA_tara, RNA_tara, DNA_RNA_tara, depth_comparison) %=% init_tara()
mala_cov <- init_mala_cov()
options(scipen=10000)
# DNA_RNA_tara <- DN
DNA_RNA_tara %>%
ggplot(aes(x=Layer_RNA, y=trans_exp_rate)) +
geom_boxplot(aes(fill = median_dna_trans))
DNA_RNA_tara %>%
filter(Layer_RNA %in% c("SRF", "DCM", "MES")) %>%
ggplot(aes(x=Layer_RNA, y=trans_exp_rate)) +
geom_boxplot(aes(fill = median_dna_trans))
DNA_RNA_tara %>%
filter(Layer_RNA %in% c("SRF", "DCM", "MES")) %>%
ggplot(aes(x=Layer_RNA, y=trans_exp_rate)) +
geom_boxplot(aes(fill = median_dna_trans)) +
labs(y = "ORF Expression Ratio") +
theme_classic() +
theme(axis.title.x=element_blank(),
axis.ticks.x = element_blank()) +
coord_cartesian(ylim = c(0, 4)) +
stat_summary(fun.data = boxplot.give.n, geom = "text", position=position_nudge(x = 0, y = -0.1)) +
scale_fill_gradient(limits = c(0, max(trans_array)+1),
low="white",
high="dodgerblue3",
name = "Median DNA\nabundance of\ntransposase\n",
breaks = c(0, trans_array),
labels = c("0%",
paste("SRF  ", round(SRF_trans_median*100, 3), "%", sep = ""),
paste("DCM ", round(DCM_trans_median*100, 3), "%\n", sep = ""),
get_depth_percent("MES", MES_trans_median),
get_depth_percent("BAT", BAT_trans_median))) +
scale_y_continuous(labels = scales::number_format(accuracy = 0.1)) +
guides(fill = guide_colourbar(barwidth = 0.6, barheight = 8,
ticks.linewidth = 3, ticks.colour = "black"))
SRF_trans_median <- get_depth_median("SRF", "Transposase")
DCM_trans_median <- get_depth_median("DCM", "Transposase")
MES_trans_median <- get_depth_median("MES", "Transposase")
BAT_trans_median <- get_depth_median("BAT", "Transposase")
trans_array <- c(SRF_trans_median, DCM_trans_median, MES_trans_median, BAT_trans_median)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path ))
source("./init_share.R")
g(DNA_tara, RNA_tara, DNA_RNA_tara, depth_comparison) %=% init_tara()
mala_cov <- init_mala_cov()
options(scipen=10000)
# DNA_RNA_tara <- DNA_RNA_tara %>% filter(Layer_DNA != "MIX")
get_depth_median <- function(depth, gene) {
sel_depth <- c("Layer_DNA", paste("DNA_", gene, sep = ""))
all_depth <- rbind(mala_cov[,sel_depth], DNA_tara[,sel_depth])
gene_depth <- all_depth[all_depth[,"Layer_DNA"] == depth,2]
return(median(gene_depth[[1]]))
}
get_depth_median2 <- function(depth, gene) {
gene_depth <- DNA_RNA_tara[DNA_RNA_tara[,"Layer_DNA"] == depth, paste("DNA_", gene, sep = "")]
return(median(gene_depth[[1]]))
}
get_depth_percent <- function(depth, num){paste(depth, " ", round(num*100, 3), "%", sep = "")}
SRF_trans_median <- get_depth_median("SRF", "Transposase")
DCM_trans_median <- get_depth_median("DCM", "Transposase")
MES_trans_median <- get_depth_median("MES", "Transposase")
BAT_trans_median <- get_depth_median("BAT", "Transposase")
trans_array <- c(SRF_trans_median, DCM_trans_median, MES_trans_median, BAT_trans_median)
DNA_RNA_tara %>%
filter(Layer_RNA %in% c("SRF", "DCM", "MES")) %>%
ggplot(aes(x=Layer_RNA, y=trans_exp_rate)) +
geom_boxplot(aes(fill = median_dna_trans)) +
labs(y = "ORF Expression Ratio") +
theme_classic() +
theme(axis.title.x=element_blank(),
axis.ticks.x = element_blank()) +
coord_cartesian(ylim = c(0, 4)) +
stat_summary(fun.data = boxplot.give.n, geom = "text", position=position_nudge(x = 0, y = -0.1)) +
scale_fill_gradient(limits = c(0, max(trans_array)+1),
low="white",
high="dodgerblue3",
name = "Median DNA\nabundance of\ntransposase\n",
breaks = c(0, trans_array),
labels = c("0%",
paste("SRF  ", round(SRF_trans_median*100, 3), "%", sep = ""),
paste("DCM ", round(DCM_trans_median*100, 3), "%\n", sep = ""),
get_depth_percent("MES", MES_trans_median),
get_depth_percent("BAT", BAT_trans_median))) +
scale_y_continuous(labels = scales::number_format(accuracy = 0.1)) +
guides(fill = guide_colourbar(barwidth = 0.6, barheight = 8,
ticks.linewidth = 3, ticks.colour = "black"))
DNA_RNA_tara %>%
filter(Layer_RNA %in% c("SRF", "DCM", "MES")) %>%
ggplot(aes(x=Layer_RNA, y=trans_exp_rate)) +
geom_boxplot(aes(fill = median_dna_trans)) +
labs(y = "ORF Expression Ratio") +
theme_classic() +
theme(axis.title.x=element_blank(),
axis.ticks.x = element_blank()) +
coord_cartesian(ylim = c(0, 4)) +
stat_summary(fun.data = boxplot.give.n, geom = "text", position=position_nudge(x = 0, y = -0.1)) +
scale_fill_gradient(limits = c(0, max(trans_array)),
low="white",
high="dodgerblue3",
name = "Median DNA\nabundance of\ntransposase\n",
breaks = c(0, trans_array),
labels = c("0%",
paste("SRF  ", round(SRF_trans_median*100, 3), "%", sep = ""),
paste("DCM ", round(DCM_trans_median*100, 3), "%\n", sep = ""),
get_depth_percent("MES", MES_trans_median),
get_depth_percent("BAT", BAT_trans_median))) +
scale_y_continuous(labels = scales::number_format(accuracy = 0.1)) +
guides(fill = guide_colourbar(barwidth = 0.6, barheight = 8,
ticks.linewidth = 3, ticks.colour = "black"))
DNA_RNA_tara %>%
filter(Layer_RNA %in% c("SRF", "DCM", "MES")) %>%
ggplot(aes(x=Layer_DNA, y=trans_exp_rate)) +
geom_boxplot(aes(fill = median_dna_trans)) +
labs(y = "ORF Expression Ratio") +
theme_classic() +
theme(axis.title.x=element_blank(),
axis.ticks.x = element_blank()) +
coord_cartesian(ylim = c(0, 4)) +
stat_summary(fun.data = boxplot.give.n, geom = "text", position=position_nudge(x = 0, y = -0.1)) +
scale_fill_gradient(limits = c(0, max(trans_array)),
low="white",
high="dodgerblue3",
name = "Median DNA\nabundance of\ntransposase\n",
breaks = c(0, trans_array),
labels = c("0%",
paste("SRF  ", round(SRF_trans_median*100, 3), "%", sep = ""),
paste("DCM ", round(DCM_trans_median*100, 3), "%\n", sep = ""),
get_depth_percent("MES", MES_trans_median),
get_depth_percent("BAT", BAT_trans_median))) +
scale_y_continuous(labels = scales::number_format(accuracy = 0.1)) +
guides(fill = guide_colourbar(barwidth = 0.6, barheight = 8,
ticks.linewidth = 3, ticks.colour = "black"))
DNA_RNA_tara <- DNA_RNA_tara %>% filter(Layer_DNA %in% c("SRF", "DCM", "MES"))
DNA_RNA_tara %>%
ggplot(aes(x=Layer_DNA, y=trans_exp_rate)) +
geom_boxplot(aes(fill = median_dna_trans)) +
labs(y = "ORF Expression Ratio") +
theme_classic() +
theme(axis.title.x=element_blank(),
axis.ticks.x = element_blank()) +
coord_cartesian(ylim = c(0, 4)) +
stat_summary(fun.data = boxplot.give.n, geom = "text", position=position_nudge(x = 0, y = -0.1)) +
scale_fill_gradient(limits = c(0, max(trans_array)),
low="white",
high="dodgerblue3",
name = "Median DNA\nabundance of\ntransposase\n",
breaks = c(0, trans_array),
labels = c("0%",
paste("SRF  ", round(SRF_trans_median*100, 3), "%", sep = ""),
paste("DCM ", round(DCM_trans_median*100, 3), "%\n", sep = ""),
get_depth_percent("MES", MES_trans_median),
get_depth_percent("BAT", BAT_trans_median))) +
scale_y_continuous(labels = scales::number_format(accuracy = 0.1)) +
guides(fill = guide_colourbar(barwidth = 0.6, barheight = 8,
ticks.linewidth = 3, ticks.colour = "black"))
